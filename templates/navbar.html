{% load static %}
<nav
  class="flex justify-between items-center w-full px-6 py-3 border-b border-black"
>
  <div id="desktopNav" class="hidden md:contents">
    <div class="flex items-center relative gap-4">
      <img src="{% static 'images/logo-square.png' %}" class="flex-grow-0 flex-shrink-0 w-10 h-10 object-cover" />
      <p class="flex-grow-0 flex-shrink-0 text-lg font-normal text-left text-black">SportZone</p>
    </div>
    <div class="flex justify-center items-center relative gap-5">
      <a href="{% url 'main:home' %}">Home</a>
      <a href="{% url 'article:show_article' %}">Artikel</a>
      <a href="{% url 'product:show_products_list' %}">Produk</a>
      {% if user.is_admin %} <a href="{% url 'admin:homepage' %}">Admin</a> {% endif %}
    </div>
    <div class="relative">
      <div class="flex justify-end items-center gap-2">
        {% if user.is_authenticated %}
        
          <button 
            type="button" 
            id="user-menu-button"
            class="flex items-center gap-2 p-1 rounded-md hover:bg-gray-100 focus:outline-none transition-colors duration-150"
          >
            {% if user.profile_pic %}
            <img src="{{ user.profile_pic }}" class="size-10 object-cover border border-black rounded-full" />
            {% else %}
            <svg
              width="40"
              height="40"
              viewBox="0 0 40 40"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              class="flex-grow-0 flex-shrink-0 w-10 h-10 relative"
              preserveAspectRatio="xMidYMid meet"
            >
              <ellipse cx="20" cy="16.6667" rx="5" ry="5" stroke="#222222" stroke-linecap="round"></ellipse>
              <circle cx="20" cy="20" r="15" stroke="#222222"></circle>
              <path
                d="M30 31.1765C29.4102 29.4046 28.1104 27.8388 26.3024 26.7221C24.4943 25.6053 22.279 25 20 25C17.721 25 15.5057 25.6053 13.6976 26.7221C11.8896 27.8388 10.5898 29.4046 10 31.1765"
                stroke="#222222"
                stroke-linecap="round"
              ></path>
            </svg>
            {% endif %}
            <p class="flex-grow-0 flex-shrink-0 text-sm font-medium text-left text-black">
              {{ user.username }}
            </p>
          </button>

          <div
            id="user-menu-dropdown"
            class="hidden absolute right-0 mt-2 w-48 top-full z-50 origin-top-right rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
            role="menu"
            aria-orientation="vertical"
            aria-labelledby="user-menu-button"
          >
            <a
              href="{% url 'userprofile:profile-page' user.username %}"
              class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              role="menuitem"
            >
              Lihat Profile
            </a>
            <a
              href="{% url 'account:logout' %}"
              class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              role="menuitem"
            >
              Logout
            </a>
          </div>
          
        {% else %} 
          <a href="{% url 'account:login' %}" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100">Login</a>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="contents md:hidden">
    <div class="flex items-center self-stretch flex-grow relative gap-4">
      <img src="{% static 'images/logo-square.png' %}" class="flex-grow-0 flex-shrink-0 w-10 h-10 object-cover" />
      <p class="flex-grow-0 flex-shrink-0 text-lg font-normal text-left text-black">SportZone</p>
    </div>
    <button id="mobileNavBtn">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M5 7H19" stroke="#222222" stroke-linecap="round"/>
        <path d="M5 12H19" stroke="#222222" stroke-linecap="round"/>
        <path d="M5 17H19" stroke="#222222" stroke-linecap="round"/>
      </svg>
    </button>
    <div class="absolute top-0 left-0 w-full h-full bg-white shadow-md z-50 hidden" id="mobileNav">
      <div class="flex justify-end">
        <button id="mobileNavCloseBtn" class="m-4">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 18L18 6M6 6L18 18" stroke="#222222" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="flex flex-col items-center py-4 w-full">
        <a href="{% url 'main:home' %}" class="border-t border-black w-full py-2 text-center">Home</a>
        <a href="{% url 'article:show_article' %}" class="border-t border-black w-full py-2 text-center">Artikel</a>
        <a href="{% url 'product:show_products_list' %}" class="border-t border-black w-full py-2 text-center">Produk</a>
        {% if user.is_admin %} <a href="{% url 'admin:homepage' %}" class="border-t border-black w-full py-2 text-center">Admin</a> {% endif %}
      </div>
      <div class="flex justify-center items-center py-2 gap-2">
        {% if user.is_authenticated %}
            {% if user.profile_pic %}
              <img src="{{ user.profile_pic }}" class="size-10 object-cover border border-black rounded-full" />
            {% else %}
              <svg
                width="40"
                height="40"
                viewBox="0 0 40 40"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                class="flex-grow-0 flex-shrink-0 w-10 h-10 relative"
                preserveAspectRatio="xMidYMid meet"
              >
                <ellipse cx="20" cy="16.6667" rx="5" ry="5" stroke="#222222" stroke-linecap="round"></ellipse>
                <circle cx="20" cy="20" r="15" stroke="#222222"></circle>
                <path
                  d="M30 31.1765C29.4102 29.4046 28.1104 27.8388 26.3024 26.7221C24.4943 25.6053 22.279 25 20 25C17.721 25 15.5057 25.6053 13.6976 26.7221C11.8896 27.8388 10.5898 29.4046 10 31.1765"
                  stroke="#222222"
                  stroke-linecap="round"
                ></path>
              </svg>
            {% endif %}
            <p class="flex-grow-0 flex-shrink-0 text-sm font-medium text-left text-black">
              {{ user.username }}
            </p>

            <a
              href="{% url 'userprofile:profile-page' user.username %}"
              class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 border border-black rounded-md"
              role="menuitem"
            >
              Lihat Profile
            </a>

            <a
              href="{% url 'account:logout' %}"
              class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 border border-black rounded-md"
              role="menuitem"
            >
              Logout
            </a>
        {% else %}
            <a href="{% url 'account:login' %}">Login</a>
        {% endif %}
      </div>
    </div>
  </div>
  <script>
    const mobileNavBtn = document.getElementById("mobileNavBtn");
    const mobileNav = document.getElementById("mobileNav");
    mobileNavBtn.addEventListener("click", () => {
      mobileNav.classList.toggle("hidden");
    });
    const mobileNavCloseBtn = document.getElementById("mobileNavCloseBtn");
    mobileNavCloseBtn.addEventListener("click", () => {
      mobileNav.classList.add("hidden");
    });

    // Pastikan elemen-elemen ini ada (hanya untuk user yang login)
    const userMenuButton = document.getElementById('user-menu-button');
    const userMenuDropdown = document.getElementById('user-menu-dropdown');

    if (userMenuButton && userMenuDropdown) {
      
      // 1. Tampilkan/sembunyikan menu ketika tombol diklik
      userMenuButton.addEventListener('click', () => {
        userMenuDropdown.classList.toggle('hidden');
      });

      // 2. Sembunyikan menu jika pengguna mengklik di luar area menu
      document.addEventListener('click', (event) => {
        // Cek apakah klik terjadi di luar tombol DAN di luar menu
        if (
          !userMenuButton.contains(event.target) &&
          !userMenuDropdown.contains(event.target)
        ) {
          userMenuDropdown.classList.add('hidden');
        }
      });
    }
  </script>
</nav>

