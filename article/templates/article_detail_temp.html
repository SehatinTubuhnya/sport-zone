{% extends 'base.html' %}

{% block content %}
<div>
  <main class="container mx-auto max-w-3xl px-4 py-8">
    
    <nav class="text-sm text-gray-500 mb-2">
      <a href="#" class="hover:underline">Home</a> &gt; 
      <a href="#" class="hover:underline">Artikel</a> &gt; 
      <span class="text-gray-700">Grand Prix Australia...</span>
    </nav>

    <h1 class="text-4xl font-bold text-gray-900 mb-3">
      Grand Prix Australia 2025: Siapa Aja Sih yang Nonton MotoGP?
    </h1>

    <p class="text-sm text-gray-600 mb-4">
      Oleh: <a href="#" class="font-medium text-black hover:underline">Jurnalis SportZone</a> | 10 September 2025
    </p>

    <div class="flex space-x-2 mb-4">
      <button class="bg-black text-white px-4 py-1 rounded-md text-sm font-medium hover:bg-gray-800">Edit Artikel</button>
      <button class="bg-red-600 text-white px-4 py-1 rounded-md text-sm font-medium hover:bg-red-700">Hapus Artikel</button>
    </div>

    <img src="https://placehold.co/800x450/CCCCCC/777777?text=MotoGP+Thumbnail" alt="MotoGP Australia" class="w-full h-auto rounded-lg shadow-md mb-6">

    <div class="prose prose-lg max-w-none text-gray-800">
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat.</p>
      <p>Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.</p>
      <h2>Sub Judul Artikel</h2>
      <p>Nullam quis risus eget urna mollis ornare vel eu leo. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
      <ul>
        <li>Poin satu</li>
        <li>Poin dua</li>
        <li>Poin tiga</li>
      </ul>
    </div>

    <hr class="my-8 border-gray-200">

    <div>
      <h2 class="text-2xl font-semibold text-gray-900 mb-4">Komentar (23)</h2>

      <div class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200 mb-6">
        <div class="flex space-x-3">
          <img src="https://placehold.co/40x40/E0E0E0/333333?text=Me" class="w-10 h-10 rounded-full" alt="My Avatar">
          <div class="flex-1">
            <textarea rows="3" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-black focus:border-black" placeholder="Tulis komentar Anda..."></textarea>
            <button class="mt-2 bg-black text-white px-5 py-2 rounded-md text-sm font-medium hover:bg-gray-800">
              Kirim
            </button>
          </div>
        </div>
      </div>

      <div class="space-y-4">
        <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
          <div class="flex space-x-3">
            <img src="https://placehold.co/40x40/E0E0E0/333333?text=SF" class="w-10 h-10 rounded-full" alt="User Avatar">
            <div>
              <p class="text-sm">
                <span class="font-semibold text-gray-900">Seorang Fan</span>
                <span class="text-gray-500">@fanleclerc · 1 hari lalu</span>
              </p>
              <p class="text-gray-800 mt-1">
                Saya saya !!!
              </p>
            </div>
          </div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
          <div class="flex space-x-3">
            <img src="https://placehold.co/40x40/E0E0E0/333333?text=SF" class="w-10 h-10 rounded-full" alt="User Avatar">
            <div>
              <p class="text-sm">
                <span class="font-semibold text-gray-900">Seorang Fan</span>
                <span class="text-gray-500">@maxfan · 3 hari lalu</span>
              </p>
              <p class="text-gray-800 mt-1">
                Haloooo
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
{% endblock %}

<!-- # Generated by Django 5.2.7 on 2025-10-24 15:36

from django.db import migrations
from django.conf import settings
import json
from pathlib import Path
from django.utils import timezone
from django.utils.html import strip_tags
from datetime import datetime

def parse_indonesian_date(date_str: str):
    if not date_str:
        return None

    bulan_map = {
        "Jan": 1, "Feb": 2, "Mar": 3, "Apr": 4, "Mei": 5,
        "Jun": 6, "Jul": 7, "Agu": 8, "Sep": 9, "Okt": 10,
        "Nov": 11, "Des": 12,
    }

    try:
        # Get the main part after the comma: "05 Okt 2025 08:10 WIB"
        parts = date_str.split(",")[-1].strip()
        # Extract day, month abbreviation, and year
        day, month_abbr, year, *_ = parts.split()
        month = bulan_map.get(month_abbr, 1)

        naive_dt = datetime(int(year), month, int(day))
        # Make it timezone aware using your default timezone
        aware_dt = timezone.make_aware(naive_dt, timezone.get_default_timezone())
        return aware_dt
    except Exception as e:
        print(f"⚠️ Failed to parse date '{date_str}': {e}")
        return None

def detect_category_from_content(content: str) -> str:
    """Detect news category from the article content."""
    content_lower = content.lower()

    # Define mapping from keywords → category
    category_keywords = {
        'Rransfer': ['transfer', 'pindah', 'bergabung', 'kontrak baru'],
        'Match': ['pertandingan', 'kalah', 'menang', 'skor', 'hasil laga'],
        'Rumor': ['rumor', 'isu', 'dikabarkan', 'gosip'],
        'Analysis': ['analisis', 'strategi', 'taktik', 'evaluasi'],
        'Exclusive': ['eksklusif', 'wawancara', 'khusus untuk'],
        'Update': ['update', 'terbaru', 'hari ini'],
    }

    # Try to find the first category that matches any keyword
    for category, keywords in category_keywords.items():
        if any(keyword in content_lower for keyword in keywords):
            return category

    # Default if nothing matches
    return 'Update'

def load_news_data(apps, schema_editor):
    News = apps.get_model('article', 'News')
    CustomUser = apps.get_model('account', 'CustomUser')  # adjust app name if different

    data_path = Path(__file__).resolve().parent.parent / 'fixtures' / 'articles.json'
    if not data_path.exists():
        print(f"❌ No dataset found at {data_path}")
        return

    with open(data_path, 'r', encoding='utf-8') as file:
        data = json.load(file)

    featured_keywords = [
        "heboh", "eksklusif", "trend", "top", "keren", "ramai", "juara", "emas",
        "tak disangka", "sorot", "terbaru", "hot", "panas", "hangat", "rekor"
    ]

    # Try assigning data to fields properly
    for entry in data:
        title = entry.get("title", "Untitled")
        content = strip_tags("\n".join(entry.get("html_contents", [])))  # combine list into one text block
        thumbnail = entry.get("img_url", "")
        author_name = entry.get("author", "Anonymous")
        created_time = parse_indonesian_date(entry.get("time", None))
        tags = ", ".join(entry.get("tags", []))
        
        # Choose category dynamically or set default
        category = detect_category_from_content(content)
        sports_type = "Other"
        is_featured = any(keyword in title.lower() for keyword in featured_keywords)
        tags = entry.get("tags", [])

        # Detect sports type dynamically — look for known sports keywords
        for tag in tags:
            tag_lower = tag.lower()
            if any(keyword in tag_lower for keyword in ["bulutangkis", "badminton", "football", "basket", 
                                                        "futsal", "voli", "renang", "tenis", "motogp",
                                                        "sambo", "polo", "besi", "boxing", "pbsi", "f1",
                                                        "mma", "bela"]):
                sports_type = tag.capitalize()
                break  # stop once we find one
        
        # Optional: find a user for the author (fallback to first admin or None)
        user = CustomUser.objects.filter(is_admin=True).first()
        
        news_item = News.objects.create(
            user=user,
            username=author_name,
            title=title,
            content=content,
            category=category,
            sports_type=sports_type,
            thumbnail=thumbnail,
            news_views=0,
            is_featured=is_featured,
            created_at=created_time
        )
        news_item.created_at = created_time
        news_item.save(update_fields=['created_at'])
    
    print(f"✅ Successfully loaded {len(data)} news items.")

class Migration(migrations.Migration):
    dependencies = [
        ('article', '0001_initial'),
    ]

    operations = [
        migrations.RunPython(load_news_data),
    ]
 -->